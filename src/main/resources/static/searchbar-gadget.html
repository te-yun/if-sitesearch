<!DOCTYPE html>
<!--
  ~ Copyright 2017 IntraFind Software AG. All rights reserved.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<meta charset="utf-8"/>
<title>Sitesearch</title>
<link rel="stylesheet" type="text/css" href="searchbar/css/app.css" media="all"/>

<script>
    function triggerFirstUsageOwnership(feedUrl) {
            console.info(feedUrl);
            const xhr = new XMLHttpRequest();
            xhr.open('PUT', 'http://sitesearch.cloud/sites/rss?feedUrl=' + feedUrl);
            xhr.onload = function () {
                console.info(this.responseText);
                console.info(JSON.parse(this.responseText));
                console.info(JSON.parse(this.responseText)['tenantId']);
                document.getElementById('tenantId').value = JSON.parse(this.responseText)['tenantId'];
                document.cookie = "override-tenant = " + JSON.parse(this.responseText)['tenantId'];
                document.getElementById('tenantSecret').value = JSON.parse(this.responseText)['tenantSecret'];
            };
            xhr.send();
        console.info("Make a feed register to Sitesearch call with this URL: " + document.getElementById("feedUrl").value);
        document.getElementById("tenantId").value = "my tenant";
        document.getElementById("tenantSecret").value = "my tenant secret";
    }
</script>

<input id="feedUrl" placeholder="Feed URL" value="http://intrafind.de/share/enterprise-search-blog.xml">
<input id="tenantId" placeholder="Tenant" style="width: 275px">
<input id="tenantSecret" placeholder="Tenant Secret" style="width: 275px">
<button onclick="triggerFirstUsageOwnership(document.getElementById('feedUrl').value)">
    Obtain site index
</button>

<div class="container" style="margin-top:0; font-size: 3em;">
    <div id="searchbar"></div>
    <div id="resultlist" style="margin-top:20px;"></div>
</div>

<script src="searchbar/js/app.js"></script>
<script>

    jQuery.noConflict();
    jQuery(document).ready(function ($) {

        IFS.initClient({
            sbTarget: '#searchbar',
            rlTarget: '#resultlist',
            configurl: 'searchbar/data/config.json',
            sitesearch: false,
            cors: true,
            withCredentials: true,
            multiple: false
        });
    });

</script>