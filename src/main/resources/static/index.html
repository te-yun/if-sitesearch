<!DOCTYPE html>
<!--
  ~ Copyright 2017 IntraFind Software AG. All rights reserved.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<html lang="en">
<meta charset="utf-8"/>
<meta name="description"
      content="Simple Site Search from the makers of the enterprise search vendor IntraFind Software AG.">
<title>Simple Site Search</title>
<link rel="stylesheet" type="text/css" href="https://sitesearch.cloud/searchbar/css/app.css"/>
<link rel="stylesheet" type="text/css" href="https://sitesearch.cloud/theme/font/css/font-awesome.min.css"/>
<script>
    const showAuthentication = async function () {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "/user");
        xhr.onload = async function () {
            if (this.status === 200 && this.responseText === "") {
                document.getElementById("user").textContent = "";
                document.getElementById("user").display = "none";
            } else {
                const user = JSON.parse(this.responseText);
                document.getElementById("user").textContent = user.userAuthentication.details.name;
                document.getElementById("user").title = user.userAuthentication.details.id;
                document.getElementById("user").display = "inline";
            }
        };
        xhr.send();
    };
    const assignSiteToTenant = async function () {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "/user");
        xhr.onload = async function () {
            if (this.status === 200 && this.responseText !== "") {
                const user = JSON.parse(this.responseText);
                document.getElementById("user").textContent = user.userAuthentication.details.name;
                document.getElementById("user").title = user.userAuthentication.details.id;
                document.getElementById("user").display = "inline";
                console.dirxml(user);
                const xhr = new XMLHttpRequest();
                xhr.open("POST", "/tenants/e10011b2-7f95-49e4-a9cb-189f5f5a6654/e10011b2-7f95-49e4-a9cb-189f5f5a6654/assign?siteSecret=c041b603-e5b7-4623-8fe9-4cd08e5b4558");
                xhr.setRequestHeader("Content-type", "application/json");
                xhr.onload = async function () {
                    document.getElementById("assignment").textContent = "{\n" +
                        "                \t\"authProviderId\": \"87507\",\n" +
                        "                \t\"contactEmail\": \"alexander.orlov@intrafind.de\",\n" +
                        "                \t\"company\": \"IntraFind Software AG\"\n" +
                        "                }";
                };
                console.warn(JSON.stringify({
                    "authProviderId": "87507",
                    "contactEmail": "alexander.orlov@intrafind.de",
                    "company": "IntraFind Software AG"
                }));
//                xhr.send(JSON.stringify({
//                	authProviderId: "87507",
//                	contactEmail: "alexander.orlov@intrafind.de",
//                	company: "IntraFind Software AG"
//                }));

                xhr.send(JSON.stringify({
                    authProviderId: "87507",
                    contactEmail: "alexander.orlov@intrafind.de",
                    company: "IntraFind Software AG"
                }));
//                xhr.send({
//                   	authProviderId: "87507",
//                   	contactEmail: "alexander.orlov@intrafind.de",
//                   	company: "IntraFind Software AG"
//                   });
            }
        };
        xhr.send();
    }
</script>
<body onload="showAuthentication()">
<h1 style="font-size: 2em;"><span class="fa fa-search"></span> Simple Site Search<sup>BETA</sup></h1>
<img src="theme/logo.png" width="361" height="105" style="float: right;">

<span id="user" class="fa fa-user"></span>
<!--<a href="/login?redirect_uri=http://localhost:8001/login/test1">Login</a>-->
<!--<a href="/login?redirect_uri=http://localhost:8001/login">Login</a>-->
<!--<a href="/login?redirect_uri=http://localhost:8001/admin/admin.html">Login</a>-->
<a href="/login">Login</a>
<a href="/logout">Logout</a>

<input id="tenantId" type="text" value="e10011b2-7f95-49e4-a9cb-189f5f5a6654" placeholder="tenantId"/>
<input id="siteId" type="text" value="a10011b2-7f95-49e4-a9cb-189f5f5a6655" placeholder="siteId"/>
<input id="siteSecret" type="text" value="b10011b2-7f95-49e4-a9cb-189f5f5a6655" placeholder="siteSecret"/>
<input id="contactEmail" type="email" value="alexander.orlov@intrafind.de" placeholder="Contact E-mail"/>
<input id="company" type="text" value="IntraFind Software AG" placeholder="Company Name"/>
<input id="authProviderId" type="text" value="87507" placeholder="oAuth2 Provider ID"/>

<button id="assignSite" onclick="assignSiteToTenant()">Assign Site to Tenant</button>
<h2>Assignment Created</h2>
<span id="assignment"></span>

<ul style="list-style: none; font-size: 1.5em;">
    <li><a class="fa fa-book" href="/swagger-ui.html" style="text-decoration: none;">
        API specification &amp; playground</a></li>
    <li><a class="fa fa-cog" href="sitesearch-gadget.html"
           style="text-decoration: none;">
        Getting started gadget</a></li>
    <li><a class="fa fa-cogs" href="gadget/main.xml" style="text-decoration: none;">
        Embeddable G**gle gadget</a></li>
    <li><a class="fa fa-cogs" href="sitesearch-integration.html" style="text-decoration: none;">
        Integrate into your site</a></li>
</ul>

<style>
    .if-teaser-highlight {
        font-weight: bold;
    }
</style>

<div class="container" style="margin-top:130px; width: 530px;">
    <div id="searchbar"></div>
    <div id="resultlist" style="margin-top:20px;"></div>
</div>

<script src="https://sitesearch.cloud/searchbar/js/app.js"></script>
<script>
    jQuery.noConflict();
    jQuery(document).ready(function ($) {
        IFS.initClient({
            sbTarget: "#searchbar",
            configurl: "searchbar-config/sitesearch-config.json",
            sitesearch: true,
            tenantId: "363d50f3-17cb-4756-aeca-7d3768092ae1"
        });

        IFS.handlebars.registerHelper("formatHighlightedUrl", function (url) {
            if (typeof url !== "undefined") {
                console.warn(url);
                console.warn(decodeURIComponent(url));
                console.warn(decodeURI(url));
                return decodeURIComponent(url);
            } else {
                return "";
            }
        });
    });
</script>

<div style="float: right">
    <span class="fa fa-user-circle-o"></span> <a href="privacy.html">Privacy</a> | <span class="fa fa-gavel"></span>
    <a href="tos.html">Terms</a> | <span class="fa fa-briefcase"></span> <a href="imprint.html">Imprint</a>
</div>

<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-105737954-1', 'auto');
    ga('send', 'pageview');
</script>
