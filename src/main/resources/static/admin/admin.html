<!DOCTYPE html>
<!--
  ~ Copyright 2017 IntraFind Software AG. All rights reserved.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<html lang="en">
<meta charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="https://sitesearch.cloud/theme/font/css/font-awesome.min.css"/>
<title>Administration</title>
<script>
    const authenticate = async function () {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "/user");
        xhr.onload = async function () {
            if (this.status === 200 && this.responseText === "") {
                console.warn("login");
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "/login");
                xhr.send();
                document.getElementById("authentication").textContent = "Sign-out";
                showAuthentication();
            } else {
                console.warn("logout");
                const xhr = new XMLHttpRequest();
                xhr.open("POST", "/logout");
                xhr.send();
                document.getElementById("authentication").textContent = "Sign-in";
                showAuthentication();
            }
        };
        xhr.send();
    };

    const showAuthentication = async function () {
        console.warn("showAuthentication()");
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "/user");
        xhr.onload = async function () {
            if (this.status === 200 && this.responseText === "") {
                document.getElementById("user").textContent = "n/a";
                document.getElementById("authentication").textContent = "Sign-in";
            } else {
                const user = JSON.parse(this.responseText);
                console.warn("sign-out");
                console.dirxml(user);
                document.getElementById("user").textContent = user.userAuthentication.details.name;
                document.getElementById("authentication").textContent = "Sign-out";
            }
        };
        xhr.send();
    }
</script>
<body onload="showAuthentication()">
<h1>Administration</h1>

<span id="user" class="fa fa-user"> </span>
<br>
<br>
<br>
<button id="authentication" onclick="authenticate()">Logout</button>

<div style="float: right">
    <a href="privacy.html">Privacy</a> | <a href="tos.html">Terms</a>
</div>
